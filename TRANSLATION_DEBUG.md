# Диагностика проблемы с сохранением переводов

## Описание проблемы
Переводы терминов не сохраняются на разных языках при редактировании слова.

## Возможные причины

### 1. Проблемы с правами доступа
- View защищен декоратором `@staff_member_required`
- Пользователь должен быть персоналом (staff member)
- Проверьте, что пользователь имеет права `is_staff=True`

### 2. Проблемы с CSRF токенами
- CSRF токен может быть недействительным
- Проверьте настройки CSRF в `settings.py`
- Убедитесь, что форма содержит `{% csrf_token %}`

### 3. Проблемы с JavaScript валидацией
- Форма может блокироваться JavaScript валидацией
- Проверьте консоль браузера на наличие ошибок
- Валидация требует заполнения всех обязательных полей

### 4. Проблемы с базой данных
- Проверьте миграции: `python manage.py showmigrations`
- Проверьте целостность БД: `python manage.py check`
- Убедитесь, что модели корректно связаны

## Шаги диагностики

### 1. Проверка логов сервера
При отправке формы в консоли сервера должны появиться сообщения:
```
POST запрос получен для слова [слово]
POST данные: <QueryDict: ...>
CSRF токен: [токен]
Обрабатываем язык [код]: слово='[перевод]', значение='[значение]...'
```

### 2. Проверка консоли браузера
Откройте Developer Tools (F12) и проверьте:
- Ошибки JavaScript
- Сетевые запросы
- Логи валидации формы

### 3. Тестирование через простую форму
Используйте тестовую страницу: `/test-translation-page/[slug]/`
Эта страница не требует авторизации и поможет изолировать проблему.

### 4. Проверка прав пользователя
```python
# В Django shell
python manage.py shell
from django.contrib.auth.models import User
user = User.objects.get(username='your_username')
print(f"is_staff: {user.is_staff}")
print(f"is_superuser: {user.is_superuser}")
```

## Исправления, внесенные в код

### 1. Улучшенная обработка ошибок в view
- Добавлена детальная отладочная информация
- Обработка исключений для каждого языка отдельно
- Логирование всех операций

### 2. Улучшенная валидация в шаблоне
- Добавлена отладочная информация
- Улучшена логика проверки полей
- Добавлены функции отладки

### 3. Тестовый endpoint
- `/test-translation/[slug]/` - API для тестирования
- `/test-translation-page/[slug]/` - HTML страница для тестирования

## Команды для проверки

```bash
# Активация виртуального окружения
source .venv/bin/activate

# Проверка Django
python manage.py check

# Проверка миграций
python manage.py showmigrations

# Запуск сервера
python manage.py runserver

# Создание суперпользователя (если нужно)
python manage.py createsuperuser
```

## Проверка в браузере

1. Откройте страницу редактирования переводов
2. Нажмите F12 для открытия Developer Tools
3. Перейдите на вкладку Console
4. Заполните форму и отправьте
5. Проверьте сообщения в консоли и на вкладке Network

## Если проблема остается

1. Проверьте, что пользователь имеет права staff
2. Убедитесь, что CSRF токен корректно передается
3. Проверьте, что все обязательные поля заполнены
4. Используйте тестовую страницу для изоляции проблемы
5. Проверьте логи сервера на наличие ошибок
