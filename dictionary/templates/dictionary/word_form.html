{% extends "dictionary/base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_head %}
{{ form.media }}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="form-title"><i class="fas fa-edit"></i> {{ title }}</h1>
        <div>
            {% if word %}
                <a href="{% url 'dictionary:word_detail' word.slug %}" class="btn btn-form-view">
                    <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                </a>
            {% endif %}
            <a href="{% url 'dictionary:home' %}" class="btn btn-form-back">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card form-card">
                <div class="card-header">
                    <h5><i class="fas fa-language"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ–≤–µ</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.word.id_for_label }}" class="form-label">
                                    {{ form.word.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.word }}
                                {% if form.word.errors %}
                                    <div class="text-danger">
                                        {% for error in form.word.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if form.word.help_text %}
                                    <div class="form-text">{{ form.word.help_text }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.language.id_for_label }}" class="form-label">
                                    {{ form.language.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.language }}
                                {% if form.language.errors %}
                                    <div class="text-danger">
                                        {% for error in form.language.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ -->
                                <div class="mt-2">
                                    <button type="button" class="btn btn-sm btn-outline-info" id="check-translation-btn" style="display: none;">
                                        <i class="fas fa-language"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ —ç—Ç–æ—Ç —è–∑—ã–∫
                                    </button>
                                    {% if word %}
                                    <a href="{% url 'dictionary:word_translations_edit_alt' word.slug %}" class="btn btn-sm btn-outline-warning d-block mt-1">
                                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ –≤—Å–µ —è–∑—ã–∫–∏
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.category.id_for_label }}" class="form-label">
                                    {{ form.category.label }}
                                    <button type="button" class="btn btn-sm btn-outline-success ms-2" onclick="showCreateCategoryModal()">
                                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary ms-1" onclick="showEditCategoryModal()" id="edit-category-btn" style="display: none;">
                                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </label>
                                {{ form.category }}
                                {% if form.category.errors %}
                                    <div class="text-danger">
                                        {% for error in form.category.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.status.id_for_label }}" class="form-label">
                                    {{ form.status.label }}
                                </label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                    <div class="text-danger">
                                        {% for error in form.status.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.tags.id_for_label }}" class="form-label">
                                {{ form.tags.label }}
                                <button type="button" class="btn btn-sm btn-outline-success ms-2" onclick="showCreateTagModal()">
                                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary ms-1" onclick="showManageTagsModal()">
                                    <i class="fas fa-cogs"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                                </button>
                            </label>
                            {{ form.tags }}
                            {% if form.tags.errors %}
                                <div class="text-danger">
                                    {% for error in form.tags.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ</div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.pronunciation.id_for_label }}" class="form-label">
                                    {{ form.pronunciation.label }}
                                </label>
                                {{ form.pronunciation }}
                                {% if form.pronunciation.errors %}
                                    <div class="text-danger">
                                        {% for error in form.pronunciation.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.difficulty.id_for_label }}" class="form-label">
                                    {{ form.difficulty.label }}
                                </label>
                                {{ form.difficulty }}
                                {% if form.difficulty.errors %}
                                    <div class="text-danger">
                                        {% for error in form.difficulty.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.meaning.id_for_label }}" class="form-label">
                                {{ form.meaning.label }} <span class="text-danger">*</span>
                            </label>
                            {{ form.meaning }}
                            {% if form.meaning.errors %}
                                <div class="text-danger">
                                    {% for error in form.meaning.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            {% if form.meaning.help_text %}
                                <div class="form-text">{{ form.meaning.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-form-submit">
                                <i class="fas fa-save"></i> {{ submit_text }}
                            </button>
                            <a href="{% url 'dictionary:home' %}" class="btn btn-form-cancel">
                                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card tips-card">
                <div class="card-header">
                    <h6><i class="fas fa-info-circle"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∏</h6>
                </div>
                <div class="card-body">
                    <h6 class="tips-title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h6>
                    <ul class="tips-list">
                        <li>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</strong> –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤</li>
                        <li>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <em>–∫—É—Ä—Å–∏–≤</em> –¥–ª—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤ –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–æ–≤</li>
                        <li>‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π</li>
                        <li>‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</li>
                        <li>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <u>–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ</u> –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–∞</li>
                        <li>‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —á–∞—Å—Ç–µ–π</li>
                        <li>‚Ä¢ –í—Å—Ç–∞–≤–ª—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏</li>
                        <li>‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</li>
                    </ul>
                    
                    <h6 class="tips-title">–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                    <ul class="tips-list">
                        <li>‚Ä¢ –ü–∏—à–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)</li>
                        <li>‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</li>
                        <li>‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–∏–Ω–æ–Ω–∏–º—ã –∏ –∞–Ω—Ç–æ–Ω–∏–º—ã</li>
                        <li>‚Ä¢ –ü—Ä–∏–≤–æ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</li>
                        <li>‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç URL –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–ª–æ–≤–∞</li>
                        <li>‚Ä¢ –î—É–±–ª–∏–∫–∞—Ç—ã —Å–ª–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è</li>
                    </ul>
                    
                    {% if recent_words %}
                    <h6 class="tips-title">–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞:</h6>
                    <ul class="tips-list">
                        {% for recent_word in recent_words %}
                        <li>‚Ä¢ <a href="{% url 'dictionary:word_detail' recent_word.slug %}" style="color: #17a2b8;">{{ recent_word.word }}</a> ({{ recent_word.language.code }})</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    
                    {% if words_without_translations %}
                    <h6 class="tips-title">–¢—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤:</h6>
                    <ul class="tips-list">
                        {% for word_no_trans in words_without_translations %}
                        <li>‚Ä¢ <a href="{% url 'dictionary:word_detail' word_no_trans.slug %}" style="color: #ffc107;">{{ word_no_trans.word }}</a> ({{ word_no_trans.language.code }})</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div class="modal fade" id="createCategoryModal" tabindex="-1" aria-labelledby="createCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content category-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="createCategoryModalLabel">
                    <i class="fas fa-folder-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createCategoryForm">
                    <div class="mb-3">
                        <label for="newCategoryCode" class="form-label">–ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newCategoryCode" placeholder="contract" required>
                        <div class="form-text">–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL)</div>
                    </div>
                    <div class="mb-3">
                        <label for="newCategoryName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newCategoryName" placeholder="–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã" required>
                        <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="createCategory()">
                    <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞ -->
<div class="modal fade" id="createTagModal" tabindex="-1" aria-labelledby="createTagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content tag-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="createTagModalLabel">
                    <i class="fas fa-tag"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createTagForm">
                    <div class="mb-3">
                        <label for="newTagCode" class="form-label">–ö–æ–¥ —Ç–µ–≥–∞ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newTagCode" placeholder="legal-term" required>
                        <div class="form-text">–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</div>
                    </div>
                    <div class="mb-3">
                        <label for="newTagName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newTagName" placeholder="–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω" required>
                        <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="createTag()">
                    <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content category-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">
                    <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editCategoryForm">
                    <input type="hidden" id="editCategoryId">
                    <div class="mb-3">
                        <label for="editCategoryCode" class="form-label">–ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editCategoryCode" required>
                        <div class="form-text">–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL)</div>
                    </div>
                    <div class="mb-3">
                        <label for="editCategoryName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editCategoryName" required>
                        <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteCategory()">
                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="updateCategory()">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏ -->
<div class="modal fade" id="manageTagsModal" tabindex="-1" aria-labelledby="manageTagsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content tag-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="manageTagsModalLabel">
                    <i class="fas fa-cogs"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <input type="text" class="form-control" id="tagSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ–≥–æ–≤..." onkeyup="filterTags()">
                </div>
                <div id="tagsList" class="tags-list">
                    <!-- –¢–µ–≥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ AJAX -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ–æ—Ä–º—ã —Å–ª–æ–≤–∞ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
.form-title {
    color: #fff;
    font-family: "Charter", "Georgia", serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin: 0;
}

.form-title i {
    margin-right: 0.5rem;
    color: #fff;
}

/* –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º—ã */
.btn-form-view {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: #fff;
    border: 2px solid #17a2b8;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;
}

.btn-form-view:hover {
    background: linear-gradient(135deg, #138496 0%, #17a2b8 100%);
    color: #fff;
    border-color: #138496;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(23,162,184,0.4);
}

.btn-form-back {
    background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
    color: #fff;
    border: 2px solid #6c757d;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;
}

.btn-form-back:hover {
    background: linear-gradient(135deg, #545b62 0%, #6c757d 100%);
    color: #fff;
    border-color: #545b62;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(108,117,125,0.4);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ñ–æ—Ä–º—ã */
.form-card, .tips-card {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border: 1px solid #333;
    border-radius: 0;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    color: #fff;
    font-family: "Charter", "Georgia", serif;
}

.form-card .card-header, .tips-card .card-header {
    background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
    border-bottom: 2px solid #333;
    color: #fff;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 1.5rem;
}

.form-card .card-header h5, .tips-card .card-header h6 {
    margin: 0;
    font-weight: 900;
    color: #fff;
}

.form-card .card-header i {
    margin-right: 0.5rem;
    color: #fff;
}

.form-card .card-body, .tips-card .card-body {
    padding: 2rem;
    background-color: #1a1a1a;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º */
.form-label {
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.form-control, .form-select {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    border-radius: 0 !important;
    color: #fff !important;
    padding: 0.75rem 1rem !important;
    font-size: 1rem !important;
    font-family: "Charter", "Georgia", serif !important;
    transition: all 0.3s ease !important;
}

.form-control::placeholder {
    color: #888 !important;
}

.form-control:focus, .form-select:focus {
    background-color: #333 !important;
    border-color: #fff !important;
    box-shadow: 0 0 0 3px rgba(255,255,255,0.1) !important;
    outline: none !important;
    color: #fff !important;
}

.form-text {
    color: #ccc;
    font-size: 0.85rem;
    font-style: italic;
}

/* TinyMCE —Ä–µ–¥–∞–∫—Ç–æ—Ä */
.tox-tinymce {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    border-radius: 0 !important;
}

.tox .tox-toolbar {
    background-color: #1a1a1a !important;
    border-bottom: 1px solid #333 !important;
}

.tox .tox-toolbar__group {
    border-right: 1px solid #333 !important;
}

.tox .tox-tbtn {
    background-color: transparent !important;
    color: #fff !important;
    border: none !important;
}

.tox .tox-tbtn:hover {
    background-color: rgba(255,255,255,0.1) !important;
}

.tox .tox-edit-area {
    background-color: #2d2d2d !important;
}

.tox .tox-edit-area__iframe {
    background-color: #2d2d2d !important;
}

/* –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º—ã */
.btn-form-submit {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: #fff;
    border: 2px solid #28a745;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 1rem 2rem;
    transition: all 0.3s ease;
}

.btn-form-submit:hover {
    background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
    color: #fff;
    border-color: #20c997;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(40,167,69,0.4);
}

.btn-form-cancel {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: #fff;
    border: 2px solid #dc3545;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 1rem 2rem;
    transition: all 0.3s ease;
}

.btn-form-cancel:hover {
    background: linear-gradient(135deg, #c82333 0%, #dc3545 100%);
    color: #fff;
    border-color: #c82333;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(220,53,69,0.4);
}

.btn i {
    margin-right: 0.5rem;
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
.tips-title {
    color: #fff;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 1rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid #333;
    padding-bottom: 0.5rem;
}

.tips-list {
    list-style: none;
    padding: 0;
    margin: 0 0 1.5rem 0;
    color: #ccc;
    font-size: 0.9rem;
    line-height: 1.6;
}

.tips-list li {
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    border-radius: 0;
    transition: all 0.3s ease;
}

.tips-list li:hover {
    background-color: rgba(255,255,255,0.05);
    transform: translateX(5px);
}

.tips-list strong {
    color: #fff;
    font-weight: 700;
}

.tips-list em {
    color: #ffc107;
    font-style: italic;
}

.tips-list u {
    color: #17a2b8;
    text-decoration: underline;
}

/* –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ */
.text-danger {
    color: #ff6b6b !important;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    font-family: "Charter", "Georgia", serif;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
.form-card, .tips-card {
    animation: fadeInUp 0.6s ease-out;
}

.form-card {
    animation-delay: 0.1s;
}

.tips-card {
    animation-delay: 0.2s;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .form-card .card-body, .tips-card .card-body {
        padding: 1.5rem;
    }
    
    .form-card .card-header, .tips-card .card-header {
        padding: 1rem;
    }
    
    .form-title {
        font-size: 1.5rem;
    }
    
    .btn {
        padding: 0.8rem 1.5rem;
        font-size: 0.9rem;
    }
    
    .tips-list {
        font-size: 0.85rem;
    }
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
.btn:active {
    transform: translateY(0);
}

.form-control:focus + .form-label {
    color: #fff;
    text-shadow: 0 0 8px rgba(255,255,255,0.3);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è select2 (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) */
.select2-container--default .select2-selection--multiple {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    border-radius: 0 !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: #007bff !important;
    color: #fff !important;
    border: none !important;
    border-radius: 0 !important;
}

.select2-dropdown {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    border-radius: 0 !important;
}

.select2-results__option {
    color: #fff !important;
    padding: 0.5rem 1rem !important;
}

.select2-results__option--highlighted {
    background-color: #007bff !important;
    color: #fff !important;
}

/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ */
.btn-outline-info {
    background: transparent;
    color: #17a2b8;
    border: 1px solid #17a2b8;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.3s ease;
}

.btn-outline-info:hover {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: #fff;
    border-color: #17a2b8;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(23,162,184,0.4);
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö */
.translation-notification {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: #fff;
    padding: 1rem;
    border-radius: 0;
    margin-top: 1rem;
    font-family: "Charter", "Georgia", serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    animation: fadeInUp 0.5s ease-out;
}

.translation-notification.warning {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: #000;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
.category-modal, .tag-modal {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border: 1px solid #333;
    border-radius: 0;
    color: #fff;
    font-family: "Charter", "Georgia", serif;
}

.category-modal .modal-header, .tag-modal .modal-header {
    background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
    border-bottom: 2px solid #333;
    color: #fff;
    padding: 1.5rem;
}

.category-modal .modal-title, .tag-modal .modal-title {
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #fff;
}

.category-modal .modal-body, .tag-modal .modal-body {
    background-color: #1a1a1a;
    padding: 2rem;
}

.category-modal .modal-footer, .tag-modal .modal-footer {
    background-color: #1a1a1a;
    border-top: 2px solid #333;
    padding: 1.5rem;
}

.btn-close {
    background: none;
    border: none;
    color: #fff;
    font-size: 1.5rem;
    opacity: 0.7;
}

.btn-close:hover {
    opacity: 1;
    color: #fff;
}

/* –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è */
.btn-outline-success {
    background: transparent;
    color: #28a745;
    border: 1px solid #28a745;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.3s ease;
}

.btn-outline-success:hover {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: #fff;
    border-color: #28a745;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.4);
}

.btn-outline-primary {
    background: transparent;
    color: #007bff;
    border: 1px solid #007bff;
    border-radius: 0;
    font-family: "Charter", "Georgia", serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: #fff;
    border-color: #007bff;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.4);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ç–µ–≥–æ–≤ */
.tags-list {
    max-height: 400px;
    overflow-y: auto;
}

.tag-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    border-bottom: 1px solid #333;
    transition: all 0.3s ease;
}

.tag-item:hover {
    background-color: rgba(255,255,255,0.05);
}

.tag-info {
    flex-grow: 1;
}

.tag-code {
    font-weight: bold;
    color: #fff;
    margin-bottom: 0.25rem;
}

.tag-name {
    color: #ccc;
    font-size: 0.9rem;
}

.tag-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const wordInput = document.querySelector('input[name="word"]');
    const languageSelect = document.querySelector('select[name="language"]');
    const checkTranslationBtn = document.getElementById('check-translation-btn');
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ª—è—Ö —Å–ª–æ–≤–∞ –∏ —è–∑—ã–∫–∞
    function checkForTranslations() {
        const word = wordInput.value.trim();
        const languageId = languageSelect.value;
        
        if (word && languageId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
            checkTranslationBtn.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞
            const selectedLanguageText = languageSelect.options[languageSelect.selectedIndex].text;
            checkTranslationBtn.innerHTML = `<i class="fas fa-language"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ ${selectedLanguageText}`;
        } else {
            checkTranslationBtn.style.display = 'none';
        }
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    wordInput.addEventListener('input', checkForTranslations);
    languageSelect.addEventListener('change', checkForTranslations);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
    checkTranslationBtn.addEventListener('click', function() {
        const word = wordInput.value.trim();
        const languageId = languageSelect.value;
        
        if (!word || !languageId) {
            alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫');
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü—Ä–æ–≤–µ—Ä—è–µ–º...';
        this.disabled = true;
        
        // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
        fetch(`/api/check-translations/?word=${encodeURIComponent(word)}&language=${languageId}`)
            .then(response => response.json())
            .then(data => {
                this.disabled = false;
                checkForTranslations(); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                const existingNotifications = document.querySelectorAll('.translation-notification');
                existingNotifications.forEach(n => n.remove());
                
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                const notification = document.createElement('div');
                
                if (data.exists) {
                    // –°–ª–æ–≤–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    notification.className = 'translation-notification warning';
                    notification.innerHTML = `
                        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –°–ª–æ–≤–æ "${word}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ.
                        <br><a href="${data.word_url}" style="color: #000; text-decoration: underline;">
                            <i class="fas fa-eye"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–ª–æ–≤–æ
                        </a>
                        ${data.translations.length > 0 ? 
                            `<br><strong>–ü–µ—Ä–µ–≤–æ–¥—ã:</strong> ${data.translations.map(t => `${t.language}: ${t.word}`).join(', ')}` 
                            : '<br><strong>–ü–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</strong>'}
                    `;
                    
                    // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–µ—Ä–µ–≤–æ–¥–æ–≤
                    setTimeout(() => {
                        if (confirm('–•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞?')) {
                            window.location.href = data.translate_url;
                        }
                    }, 2000);
                    
                } else if (data.similar_words.length > 0) {
                    // –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ö–æ–∂–∏–µ —Å–ª–æ–≤–∞
                    notification.className = 'translation-notification';
                    notification.innerHTML = `
                        <strong>üí° –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ö–æ–∂–∏–µ —Å–ª–æ–≤–∞:</strong>
                        <br>${data.similar_words.map(w => 
                            `<a href="${w.url}" style="color: #fff; text-decoration: underline;">${w.word}</a>`
                        ).join(', ')}
                    `;
                } else {
                    // –°–ª–æ–≤–æ –Ω–æ–≤–æ–µ
                    notification.className = 'translation-notification';
                    notification.innerHTML = `
                        <strong>‚úÖ –û—Ç–ª–∏—á–Ω–æ!</strong> –°–ª–æ–≤–æ "${word}" –Ω–æ–≤–æ–µ. 
                        –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã.
                    `;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏
                checkTranslationBtn.parentNode.appendChild(notification);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 10000);
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:', error);
                this.disabled = false;
                checkForTranslations();
                
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            });
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    checkForTranslations();
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ç–µ–≥–∞–º–∏
function showCreateCategoryModal() {
    const modal = new bootstrap.Modal(document.getElementById('createCategoryModal'));
    modal.show();
}

function showCreateTagModal() {
    const modal = new bootstrap.Modal(document.getElementById('createTagModal'));
    modal.show();
}

function createCategory() {
    const code = document.getElementById('newCategoryCode').value.trim();
    const name = document.getElementById('newCategoryName').value.trim();
    
    if (!code || !name) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–∫–æ–¥ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ)');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ–∑–¥–∞–µ–º...';
    btn.disabled = true;
    
    // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    fetch('/api/create-category/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            code: code,
            name: name
        })
    })
    .then(response => response.json())
    .then(data => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        if (data.success) {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ select
            const categorySelect = document.querySelector('select[name="category"]');
            const newOption = document.createElement('option');
            newOption.value = data.category.id;
            newOption.textContent = data.category.code;
            newOption.selected = true;
            categorySelect.appendChild(newOption);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = bootstrap.Modal.getInstance(document.getElementById('createCategoryModal'));
            modal.hide();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('createCategoryForm').reset();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showSuccessNotification(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${data.category.code}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!`);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é'));
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    });
}

function createTag() {
    const code = document.getElementById('newTagCode').value.trim();
    const name = document.getElementById('newTagName').value.trim();
    const description = document.getElementById('newTagDescription').value.trim();
    
    if (!code || !name) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–∫–æ–¥ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ)');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ–∑–¥–∞–µ–º...';
    btn.disabled = true;
    
    // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞
    fetch('/api/create-tag/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            code: code,
            name: name
        })
    })
    .then(response => response.json())
    .then(data => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        if (data.success) {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–µ–≥ –≤ select (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π select)
            const tagSelect = document.querySelector('select[name="tags"]');
            if (tagSelect) {
                const newOption = document.createElement('option');
                newOption.value = data.tag.id;
                newOption.textContent = data.tag.code;
                newOption.selected = true;
                tagSelect.appendChild(newOption);
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = bootstrap.Modal.getInstance(document.getElementById('createTagModal'));
            modal.hide();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('createTagForm').reset();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showSuccessNotification(`–¢–µ–≥ "${data.tag.code}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–µ–≥'));
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞:', error);
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    });
}

function showSuccessNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'translation-notification';
    notification.innerHTML = `<strong>‚úÖ –£—Å–ø–µ—Ö!</strong> ${message}`;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form');
    form.insertBefore(notification, form.firstChild);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
function showEditCategoryModal() {
    const categorySelect = document.querySelector('select[name="category"]');
    const categoryId = categorySelect.value;
    
    if (!categoryId) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        return;
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    fetch(`/api/get-category/${categoryId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('editCategoryId').value = data.category.id;
                document.getElementById('editCategoryCode').value = data.category.code;
                document.getElementById('editCategoryName').value = data.category.name;
                
                const modal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
                modal.show();
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ' + data.error);
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
        });
}

function updateCategory() {
    const id = document.getElementById('editCategoryId').value;
    const code = document.getElementById('editCategoryCode').value.trim();
    const name = document.getElementById('editCategoryName').value.trim();
    
    if (!code || !name) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ—Ö—Ä–∞–Ω—è–µ–º...';
    btn.disabled = true;
    
    fetch(`/api/update-category/${id}/`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            code: code,
            name: name
        })
    })
    .then(response => response.json())
    .then(data => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º option –≤ select
            const categorySelect = document.querySelector('select[name="category"]');
            const option = categorySelect.querySelector(`option[value="${id}"]`);
            if (option) {
                option.textContent = data.category.code;
            }
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('editCategoryModal'));
            modal.hide();
            
            showSuccessNotification(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${data.category.code}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞!`);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
    });
}

function deleteCategory() {
    const id = document.getElementById('editCategoryId').value;
    const code = document.getElementById('editCategoryCode').value;
    
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${code}"?\n–í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –£–¥–∞–ª—è–µ–º...';
    btn.disabled = true;
    
    fetch(`/api/delete-category/${id}/`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        if (data.success) {
            // –£–¥–∞–ª—è–µ–º option –∏–∑ select
            const categorySelect = document.querySelector('select[name="category"]');
            const option = categorySelect.querySelector(`option[value="${id}"]`);
            if (option) {
                option.remove();
                categorySelect.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            }
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('editCategoryModal'));
            modal.hide();
            
            showSuccessNotification(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${code}" —É–¥–∞–ª–µ–Ω–∞!`);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('edit-category-btn').style.display = 'none';
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏
function showManageTagsModal() {
    const modal = new bootstrap.Modal(document.getElementById('manageTagsModal'));
    modal.show();
    loadTags();
}

function loadTags() {
    const tagsList = document.getElementById('tagsList');
    tagsList.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
    
    fetch('/api/get-tags/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                renderTags(data.tags);
            } else {
                tagsList.innerHTML = '<div class="text-center text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–≥–æ–≤</div>';
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            tagsList.innerHTML = '<div class="text-center text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–≥–æ–≤</div>';
        });
}

function renderTags(tags) {
    const tagsList = document.getElementById('tagsList');
    
    if (tags.length === 0) {
        tagsList.innerHTML = '<div class="text-center text-muted">–¢–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        return;
    }
    
    tagsList.innerHTML = tags.map(tag => `
        <div class="tag-item" data-tag-code="${tag.code}">
            <div class="tag-info">
                <div class="tag-code">${tag.code}</div>
                <div class="tag-name">${tag.name}</div>
            </div>
            <div class="tag-actions">
                <button class="btn btn-sm btn-outline-primary" onclick="editTag(${tag.id}, '${tag.code}', '${tag.name}')">
                    <i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteTag(${tag.id}, '${tag.code}')">
                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
    `).join('');
}

function filterTags() {
    const search = document.getElementById('tagSearch').value.toLowerCase();
    const tagItems = document.querySelectorAll('.tag-item');
    
    tagItems.forEach(item => {
        const code = item.dataset.tagCode.toLowerCase();
        const name = item.querySelector('.tag-name').textContent.toLowerCase();
        
        if (code.includes(search) || name.includes(search)) {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

function editTag(id, code, name) {
    const newCode = prompt('–ù–æ–≤—ã–π –∫–æ–¥ —Ç–µ–≥–∞:', code);
    if (!newCode || newCode === code) return;
    
    const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞:', name);
    if (!newName) return;
    
    fetch(`/api/update-tag/${id}/`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            code: newCode,
            name: newName
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadTags(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            
            // –û–±–Ω–æ–≤–ª—è–µ–º select —Ç–µ–≥–æ–≤
            const tagSelect = document.querySelector('select[name="tags"]');
            if (tagSelect) {
                const option = tagSelect.querySelector(`option[value="${id}"]`);
                if (option) {
                    option.textContent = data.tag.code;
                }
            }
            
            showSuccessNotification(`–¢–µ–≥ "${data.tag.code}" –æ–±–Ω–æ–≤–ª–µ–Ω!`);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞');
    });
}

function deleteTag(id, code) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–µ–≥ "${code}"?`)) {
        return;
    }
    
    fetch(`/api/delete-tag/${id}/`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadTags(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ select —Ç–µ–≥–æ–≤
            const tagSelect = document.querySelector('select[name="tags"]');
            if (tagSelect) {
                const option = tagSelect.querySelector(`option[value="${id}"]`);
                if (option) {
                    option.remove();
                }
            }
            
            showSuccessNotification(`–¢–µ–≥ "${code}" —É–¥–∞–ª–µ–Ω!`);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞');
    });
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.querySelector('select[name="category"]');
    const editBtn = document.getElementById('edit-category-btn');
    
    if (categorySelect && editBtn) {
        categorySelect.addEventListener('change', function() {
            if (this.value) {
                editBtn.style.display = 'inline-block';
            } else {
                editBtn.style.display = 'none';
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (categorySelect.value) {
            editBtn.style.display = 'inline-block';
        }
    }
});
</script>
{% endblock %} 